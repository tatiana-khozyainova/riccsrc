unit ResearchGroup;

interface

uses BaseObjects, BaseReport, CommonReport, LasFile, Classes, Material, Encoder;

type
  TInfoGroup = class(TIDObject)
  private
    FTestQuery: string;
    FTag: string;
    FTestQueryResult: OleVariant;
    FPlace: string;
    FIsSingle: Boolean;
  protected
    function  PrepareTestQuery: string; virtual;
    procedure InternalRetrieveObjectInfo(AObject: TIDObject; ADestinationPath: string = ''; AObjectList: TIDObjects = nil); virtual;
    procedure InternalRetrieveObjectsInfo(AObjects: TIDObjects; ADestinationPath: string = ''; AObjectList: TIDObjects = nil); virtual;
    procedure InitializeInfoGroup; virtual;
    function GetUserFolderName: string; virtual;
  public
    property  TestQuery: string read FTestQuery write FTestQuery;
    property  TestQueryResult: OleVariant read FTestQueryResult;
    property  UserFolderName: string read GetUserFolderName;

    function  ObjectInfoExists(AObject: TIDObject): Boolean;
    property  Tag: string read FTag write FTag;
    property  Place: string read FPlace write FPlace;
    property  IsSingle: Boolean read FIsSingle write FIsSingle;

    procedure RetrieveObjectInfo(AObject: TIDObject; ADestinationPath: string = ''; AObjectList: TIDObjects = nil);
    procedure RetrieveObjectsInfo(AObjects: TIDObjects; ADestinationPath: string = ''; AObjectList: TIDObjects = nil);
    constructor Create(ACollection: TIDObjects); override;
  end;

  TInfoGroupClassType = class of TInfoGroup;

  TReportInfoGroup = class(TInfoGroup)
  private
    FReport: TBaseReport;
    FReportClass: TBaseReportClass;
  protected
    procedure InternalRetrieveObjectInfo(AObject: TIDObject; ADestinationPath: string = ''; AObjectList: TIDObjects = nil); override;
    procedure InternalRetrieveObjectsInfo(AObjects: TIDObjects; ADestinationPath: string = ''; AObjectList: TIDObjects = nil); override;
    function  GetUserFolderName: string; override;
  public
    property ReportClass: TBaseReportClass read FReportClass write FReportClass;
    property Report: TBaseReport read FReport;
  end;

  TFileInfoGroup = class(TInfoGroup)
  private
    FSourceBaseDir: string;
    FOldFileName: string;
    FNewFilename: string;
    FDefaultExt: string;
  protected
    procedure DoAfterCopy(); virtual;
    procedure InternalRetrieveObjectInfo(AObject: TIDObject; ADestinationPath: string = ''; AObjectList: TIDObjects = nil); override;
  public
    property  DefaultExt: string read FDefaultExt write FDefaultExt; 
    property  FileName: string read FNewFilename write FNewFileName;
    property  OldFileName: string read FOldFileName write FOldFileName;
    property  SourceBaseDir: string read FSourceBaseDir write FSourceBaseDir;
  end;

  TLasFileInfoGroup = class(TFileInfoGroup)
  private
    FLasFileContent: TLasFileContent;
    FCurvesToCrop: TStringList;
    FCropCurves: boolean;
    FCropBlocks: Boolean;
    FEncoding: TEncoding;
    FMakeReplacements: boolean;
    FReplacementList: TReplacementList;
    FBlocksToLeave: TStringList;
    function GetCurvesToCrop: TStringList;
    function GetBlocksToLeave: TStringList;
 protected
    procedure InitializeInfoGroup; override;
    procedure DoAfterCopy(); override;
    procedure InternalRetrieveObjectInfo(AObject: TIDObject; ADestinationPath: string = ''; AObjectList: TIDObjects = nil); override;
    function  GetUserFolderName: string; override;
  public
    property Encoding: TEncoding read FEncoding write FEncoding;
    property LasFileContent: TLasFileContent read FLasFileContent;

    property CropCurves: Boolean read FCropCurves write FCropCurves;
    property CurvesToLeave: TStringList read GetCurvesToCrop;

    property CropBlocks: boolean read FCropBlocks write FCropBlocks;
    property BlocksToLeave: TStringList read GetBlocksToLeave;

    property MakeReplacements: boolean read FMakeReplacements write FMakeReplacements;
    property Replacements: TReplacementList read FReplacementList write FReplacementList;

    destructor Destroy; override;
  end;

  TAllLasFileCopyAnsi = class(TLasFileInfoGroup)
  protected
    procedure InitializeInfoGroup; override;
  end;

  TAllLasFileCopyAscii = class(TLasFileInfoGroup)
  protected
    procedure InitializeInfoGroup; override;
  end;

  TDMFileInfoGroup = class(TFileInfoGroup)
  private
    FDocTypeName: string;

  protected
    FDocumentTypes: TDocumentTypes;
    procedure DoAfterCopy; override;
    procedure InternalRetrieveObjectInfo(AObject: TIDObject;
      ADestinationPath: string = ''; AObjectList: TIDObjects = nil); override;

    function  GetDocumentTypes: TDocumentTypes; virtual;
    procedure InitializeInfoGroup; override;
    function  PrepareTestQuery: string; override;
  public
    property   DocTypeName: string read FDocTypeName write FDocTypeName;
    property   DocumentTypes: TDocumentTypes read GetDocumentTypes;
    destructor Destroy; override;
  end;


  TLasReplacements = class(TReplacementList)
  public
    constructor Create; override;
  end;

  TGKNGKLasFileInfoGroup = class(TLasFileInfoGroup)
  protected
    procedure InitializeInfoGroup; override;
  end;

  TStLasFileInfoGroup = class(TLasFileInfoGroup)
  protected
    procedure InitializeInfoGroup; override;
  end;

  TAKLasFileInfoGroup = class(TLasFileInfoGroup)
  protected
    procedure InitializeInfoGroup; override;
  end;




  TPetrophisicsReportInfoGroup = class(TReportInfoGroup)
  protected
    procedure InitializeInfoGroup; override;
  end;

  TGranulometryReportInfoGroup = class(TReportInfoGroup)
  protected
    procedure InitializeInfoGroup; override;
  end;

  TCentrifugingReportInfoGroup = class(TReportInfoGroup)
  protected
    procedure InitializeInfoGroup; override;
  end;

  TCoreDescriptionFileInfoGroup = class(TDMFileInfoGroup)
  protected
    procedure InitializeInfoGroup; override;
  end;

  TSchlamDescriptionFileInfoGroup = class(TDMFileInfoGroup)
  protected
    procedure InitializeInfoGroup; override;
  end;


  TSchlifDescriptionFileInfoGroup = class(TDMFileInfoGroup)
  protected
    procedure InitializeInfoGroup; override;
  end;

  TInclinometrFileInfoGroup = class(TDMFileInfoGroup)
  protected
    procedure InitializeInfoGroup; override;
  end;

  TDMPetrofisicsFileInfoGroup = class(TDMFileInfoGroup)
  protected
    procedure InitializeInfoGroup; override;
    function GetUserFolderName: string; override;    
  end;

  TStandardSubdivisionReportInfoGroup = class(TReportInfoGroup)
  protected
    procedure InitializeInfoGroup; override;
  end;



  TInfoGroups = class(TIDObjects)
  private
    function GetItems(const Index: Integer): TInfoGroup;
  public
    function AreSingle: Boolean;
    function HaveSingle: Boolean;
    function AddInfoGroupClass(AInfoGroupClassType: TInfoGroupClassType): TInfoGroup;
    property Items[const Index: Integer]: TInfoGroup read GetItems;
    constructor Create; override;
  end;

implementation

uses Facade, SysUtils, Variants, Windows, PetrophisicsReports, SubdivisionReports, FileUtils;

{ TInfoGroups }

function TInfoGroups.AddInfoGroupClass(
  AInfoGroupClassType: TInfoGroupClassType): TInfoGroup;
begin
  Result := AInfoGroupClassType.Create(Self);
  inherited Add(Result, False, False);
end;

function TInfoGroups.AreSingle: Boolean;
var i: Integer;
begin
  Result := True;
  for i := 0 to Count - 1 do
    Result := Result and Items[i].IsSingle;
end;

constructor TInfoGroups.Create;
begin
  inherited;
  FObjectClass := TInfoGroup;
  FDataPoster := nil;
end;

function TInfoGroups.GetItems(const Index: Integer): TInfoGroup;
begin
  Result := inherited Items[index] as TInfoGroup;
end;

function TInfoGroups.HaveSingle: Boolean;
var i: Integer;
begin
  Result := false;
  for i := 0 to Count - 1 do
    Result := Result or Items[i].IsSingle;
end;

{ TInfoGroup }

constructor TInfoGroup.Create(ACollection: TIDObjects);
begin
  inherited;
  FDataPoster := nil;
  ClassIDString := 'Группа исследований';

  InitializeInfoGroup;

end;

function TInfoGroup.GetUserFolderName: string;
begin
  Result := Name;
end;

procedure TInfoGroup.InitializeInfoGroup;
begin

end;

procedure TInfoGroup.InternalRetrieveObjectInfo(AObject: TIDObject; ADestinationPath: string = ''; AObjectList: TIDObjects = nil);
begin

end;

procedure TInfoGroup.InternalRetrieveObjectsInfo(AObjects: TIDObjects;
  ADestinationPath: string; AObjectList: TIDObjects);
begin

end;

function TInfoGroup.ObjectInfoExists(AObject: TIDObject): Boolean;
var sQuery: string;
begin
  sQuery := PrepareTestQuery;
  sQuery := Format(sQuery, [IntToStr(AObject.ID)]);
  Result := TMainFacade.GetInstance.ExecuteQuery(sQuery, FTestQueryResult) > 0;
end;

function TInfoGroup.PrepareTestQuery: string;
begin
  Result := TestQuery;
end;

procedure TInfoGroup.RetrieveObjectInfo(AObject: TIDObject; ADestinationPath: string = ''; AObjectList: TIDObjects = nil);
begin
  if ObjectInfoExists(AObject) then
    InternalRetrieveObjectInfo(AObject, ADestinationPath, AObjectList);
end;

procedure TInfoGroup.RetrieveObjectsInfo(AObjects: TIDObjects;
  ADestinationPath: string; AObjectList: TIDObjects);
begin
  InternalRetrieveObjectsInfo(AObjects, ADestinationPath, AObjectList);
end;

{ TFileInfoGroup }

procedure TFileInfoGroup.DoAfterCopy;
begin

end;

procedure TFileInfoGroup.InternalRetrieveObjectInfo(AObject: TIDObject; ADestinationPath: string = ''; AObjectList: TIDObjects = nil);
var i: integer;
    sLastFileName, sRealExt: string;
begin
  inherited;

  // копирует файлы из BaseDir в ADestinationPath
  if (not varIsEmpty(FTestQueryResult)) and (not varIsNull(FTestQueryResult)) then
  begin
    sLastFileName := '';  
    for i := 0 to VarArrayHighBound(FTestQueryResult, 2) do
    begin
      FOldFileName := SourceBaseDir + varAsType(FTestQueryResult[0, i], varOleStr);

      sLastFileName := FNewFilename;
      if VarArrayHighBound(FTestQueryResult, 1) = 0 then
        FNewFileName := ADestinationPath + '\' + ExtractFileName(FOldFileName)
      else if VarArrayHighBound(FTestQueryResult, 1) > 0 then
        FNewFileName := ADestinationPath + '\' + ExtractFileName(varAsType(FTestQueryResult[1, i], varOleStr));

      if (i > 0) and (sLastFileName = FNewFilename) then
        FNewFilename := StringReplace(FNewFilename, '.', '(' + IntToStr(i + 1) + ').', []);

      if VarArrayHighBound(FTestQueryResult, 1) > 1 then // третий столбец - источник расширения
      begin
        sRealExt := ExtractFileExt(varAsType(FTestQueryResult[2, i], varOleStr));
        FNewFilename := ChangeFileExt(FNewFilename, sRealExt);
      end;

      FNewFilename := CorrectFileName(FNewFilename);

      if FileExists(FOldFileName) then
      begin
        //try
          CopyFile(PChar(FOldFileName), PChar(FNewFileName), False);
          DoAfterCopy();
        //except
          // !!
        //end;
      end;
    end;
  end;
end;

{ TGKNGKLasFileInfoGroup }


procedure TGKNGKLasFileInfoGroup.InitializeInfoGroup;
begin
  inherited;
  TestQuery := 'select distinct lf.vch_filename, lf.vch_old_filename from tbl_las_file lf, tbl_las_curve lc, tbl_curve_dict cc where cc.curve_id = lc.curve_id and lf.las_file_uin = lc.las_file_uin and cc.curve_category_id in (7,8,15,16) and lf.well_uin = %s';


  Name := 'ГК, НГК, ГГКП';
  Encoding := encAnsi;
   
  CropCurves := True;
  CurvesToLeave.Add('DEPT');
  CurvesToLeave.Add('DEPTH');
  CurvesToLeave.Add('GGKp');
  CurvesToLeave.Add('GK');
  CurvesToLeave.Add('GK d_k');
  CurvesToLeave.Add('GKp_k');
  CurvesToLeave.Add('GR');
  CurvesToLeave.Add('GR2');
  CurvesToLeave.Add('NEUT');
  CurvesToLeave.Add('NGK');
  CurvesToLeave.Add('NGL');
  CurvesToLeave.Add('NGR');
  CurvesToLeave.Add('NKTB');
  CurvesToLeave.Add('NKTM');
  CurvesToLeave.Add('NKtb');
  CurvesToLeave.Add('NPHI');
  CurvesToLeave.Add('RHOB');
  CurvesToLeave.Add('TNNB');
  CurvesToLeave.Add('TNNS');
  CurvesToLeave.Add('ГГКП');
  CurvesToLeave.Add('ГГКП1');
  CurvesToLeave.Add('ГГКп');
  CurvesToLeave.Add('ГГКп_к');
  CurvesToLeave.Add('ГК');
  CurvesToLeave.Add('ГК   св1');
  CurvesToLeave.Add('ГК  св2');
  CurvesToLeave.Add('ГК-брак');
  CurvesToLeave.Add('ГК1');
  CurvesToLeave.Add('ГК2');
  CurvesToLeave.Add('ГКН');
  CurvesToLeave.Add('ГКи');
  CurvesToLeave.Add('ГКк');
  CurvesToLeave.Add('ГКсв');
  CurvesToLeave.Add('НГК');
  CurvesToLeave.Add('НГК  св1');
  CurvesToLeave.Add('НГК  св2');
  CurvesToLeave.Add('НК');
  CurvesToLeave.Add('НКТ');
  CurvesToLeave.Add('НКТБ');
  CurvesToLeave.Add('НКТБк');
  CurvesToLeave.Add('НКТМ');
  CurvesToLeave.Add('НКТМк');
  CurvesToLeave.Add('НКТб');
  CurvesToLeave.Add('НКТм');
  CurvesToLeave.Add('ННКТ');
  CurvesToLeave.Add('ННКТБ');
  CurvesToLeave.Add('ННКТб');
  CurvesToLeave.Add('ННКТм');
  CurvesToLeave.Add('ННКтБЗ');
  CurvesToLeave.Add('ННКтМЗ');
  CurvesToLeave.Add('НННБ');
  CurvesToLeave.Add('НННМ');
  CurvesToLeave.Add('ННТБ');
  CurvesToLeave.Add('ННТМ');

  FReplacementList := TLasReplacements.Create;
  ////1-------- это для такого случая:   WeLL.     WELL:5----------------//
  Replacements.AddReplacement('~Well', 'WELL', '   WELL:2', '2_Saluk: ');
  Replacements.AddReplacement('~Well', 'FLD', 'FIELD:Салюкинская (-ое)', '     :                 ');

  //Replacements.AddReplacement('~Well', 'WELL', '        91', '91_Yareyag');
  //Replacements.AddReplacement('~Well', 'FLD', 'Ярейягинская', '            ');

  Replacements.AddReplacement('~Curve','А','А','A');
  Replacements.AddReplacement('~Curve','Б','Б','B');
  Replacements.AddReplacement('~Curve','В','В','V');
  Replacements.AddReplacement('~Curve','Г','Г','G');
  Replacements.AddReplacement('~Curve','Д','Д','D');
  Replacements.AddReplacement('~Curve','Е','Е','E');
  Replacements.AddReplacement('~Curve','Ж','Ж','J');
  Replacements.AddReplacement('~Curve','З','З','Z');
  Replacements.AddReplacement('~Curve','И','И','I');
  Replacements.AddReplacement('~Curve','К','К','K');
  Replacements.AddReplacement('~Curve','Л','Л','L');
  Replacements.AddReplacement('~Curve','М','М','M');
  Replacements.AddReplacement('~Curve','Н','Н','N');
  Replacements.AddReplacement('~Curve','О','О','O');
  Replacements.AddReplacement('~Curve','П','П','P');
  Replacements.AddReplacement('~Curve','Р','Р','R');
  Replacements.AddReplacement('~Curve','С','С','S');
  Replacements.AddReplacement('~Curve','Т','Т','T');
  Replacements.AddReplacement('~Curve','У','У','U');
  Replacements.AddReplacement('~Curve','Ф','Ф','F');
  Replacements.AddReplacement('~Curve','Х','Х','H');
  Replacements.AddReplacement('~Curve','Ц','Ц','C');
  Replacements.AddReplacement('~Curve','Ч','Ч','Ch');
  Replacements.AddReplacement('~Curve','Ш','Ш','Sh');
  Replacements.AddReplacement('~Curve','Щ','Щ','Sch');
  Replacements.AddReplacement('~Curve','Э','Э','A');
  Replacements.AddReplacement('~Curve','Ю','Ю','U');
  Replacements.AddReplacement('~Curve','Я','Я','Ya');  
end;

{ TLasFileInfoGroup }


destructor TLasFileInfoGroup.Destroy;
begin
  FreeAndNil(FReplacementList);
  FreeAndNil(FBlocksToLeave);
  FreeAndNil(FCurvesToCrop);  
  inherited;
end;


procedure TLasFileInfoGroup.DoAfterCopy;
var
    sFileName: string;
begin
  inherited;
  sFileName := FileName + '_';
  TEncoder.GetInstance.DecodeFile(FileName, sFileName);
  FLasFileContent := TLasFileContent.Create(sFileName);
 // FLasFileContent.ReadFile;

  if CropCurves then
    FLasFileContent.CropAllExceptListedCurves(CurvesToLeave);

  if CropBlocks then
    FLasFileContent.CropAllExceptListedBlocks(BlocksToLeave);
  if MakeReplacements then
    {FLasFileContent.MakeReplacements(Replacements);   }

  case Encoding of
  encAscii:
  begin
    FLasFileContent.SaveFile();
    TEncoder.GetInstance.EncodeFile(sFileName, FileName);
  end;
  encAnsi:
    FLasFileContent.SaveFile(FileName);
  end;

  DeleteFile(PChar(sFileName));
end;

function TLasFileInfoGroup.GetBlocksToLeave: TStringList;
begin
  if not Assigned(FBlocksToLeave) then
    FBlocksToLeave := TStringList.Create;
  Result := FBlocksToLeave;
end;



function TLasFileInfoGroup.GetCurvesToCrop: TStringList;
begin
  if not Assigned(FCurvesToCrop) then
    FCurvesToCrop := TStringList.Create;
  Result := FCurvesToCrop;
end;




function TLasFileInfoGroup.GetUserFolderName: string;
begin
  Result := Tag + '\' + Name;
end;

procedure TLasFileInfoGroup.InitializeInfoGroup;
begin
  inherited;
  Tag := 'LAS-файлы';
  SourceBaseDir := '\\SRVDB.TPRC\LasBank\LasBank';
  Place := 'РБЦГИ';
  DefaultExt := '.las';

  CropCurves := true;
  MakeReplacements := true;
  CropBlocks := true;
  Encoding := encAnsi;

  BlocksToLeave.Add('~Version');
  BlocksToLeave.Add('~Well');
  BlocksToLeave.Add('~Curve');
  BlocksToLeave.Add('~A');  
end;

procedure TLasFileInfoGroup.InternalRetrieveObjectInfo(AObject: TIDObject;
  ADestinationPath: string = ''; AObjectList: TIDObjects = nil);
begin
  inherited;
end;       

{ TPetrophisicsReportInfoGroup }

procedure TPetrophisicsReportInfoGroup.InitializeInfoGroup;
begin
  inherited;
  TestQuery := 'select * from tbl_dnr_research d, tbl_rock_sample rs, tbl_slotting s where d.rock_sample_uin = rs.rock_sample_uin and s.slotting_uin = rs.slotting_uin and d.research_id >= 100 and d.research_id < 200 and s.Well_UIN = %s';
  Name := 'Общие петрофизические свойства';
  Tag := 'Петрофизика';
  Place := 'РБЦГИ';
  ReportClass := TPetrophisicsReport;
end;

{ TReportInfoGroup }

function TReportInfoGroup.GetUserFolderName: string;
begin
  Result := Tag;
end;

procedure TReportInfoGroup.InternalRetrieveObjectInfo(AObject: TIDObject;
  ADestinationPath: string = ''; AObjectList: TIDObjects = nil);
begin
  inherited;
  FReport := ReportClass.Create(nil);
  FReport.ReportPath := ADestinationPath;
  FReport.MakeVisible := false;
  FReport.ReportingObjects.Clear;
  FReport.ReportingObjects.Add(AObject, False, False);

  // все объекты
  if Assigned(AObjectList) then
  begin
    FReport.AllObjects.Clear;
    FReport.AllObjects.AddObjects(AObjectList, False, False);
  end;

  FReport.Execute;
  FReport.Free;
end;

procedure TReportInfoGroup.InternalRetrieveObjectsInfo(
  AObjects: TIDObjects; ADestinationPath: string; AObjectList: TIDObjects);
begin
  FReport := ReportClass.Create(nil);
  FReport.ReportPath := ADestinationPath;
  FReport.MakeVisible := false;
  FReport.ReportingObjects.Clear;
  FReport.ReportingObjects.AddObjects(AObjects, False, False);

  // все объекты
  if Assigned(AObjectList) then
  begin
    FReport.AllObjects.Clear;
    FReport.AllObjects.AddObjects(AObjectList, False, False);
  end;

  FReport.Execute;
  FReport.Free;
end;

{ TDMFileInfoGroup }

destructor TDMFileInfoGroup.Destroy;
begin
  FreeAndNil(FDocumentTypes);
  inherited;
end;

procedure TDMFileInfoGroup.DoAfterCopy;
begin
  inherited;
  
end;

function TDMFileInfoGroup.GetDocumentTypes: TDocumentTypes;
begin
  if not Assigned(FDocumentTypes) then
  begin
    FDocumentTypes := TDocumentTypes.Create;
    FDocumentTypes.Poster := nil;
    FDocumentTypes.OwnsObjects := false;
  end;
  Result := FDocumentTypes;
end;

procedure TDMFileInfoGroup.InitializeInfoGroup;
begin
  inherited;
  Tag := 'Документы и материалы';
  SourceBaseDir := '';
  Place := 'РБЦГИ';

  TestQuery := 'select m.vch_location, rf_trim(rf_strreplace(' + '''' + ':DOC_TYPE_NAME ' + '''' + '||w.vch_well_num||' + '''' + ' - ' + '''' + '||a.vch_area_name,' + '''' + '(-ое)' + '''' + ',' + '''' + '''' + '))||' + '''' + DefaultExt + '''' +  
               'from tbl_material m, tbl_material_binding mb, tbl_well w, tbl_area_dict a ' +
               'where m.material_type_id in (:MATERIAL_TYPES_ID) and m.material_id = mb.material_id and mb.object_bind_type_id = 1 ' +
               'and w.area_id = a.area_id and mb.object_bind_id = w.well_uin ' +
               'and mb.object_bind_id = %s';
end;

procedure TDMFileInfoGroup.InternalRetrieveObjectInfo(AObject: TIDObject;
  ADestinationPath: string = ''; AObjectList: TIDObjects = nil);
begin
  inherited;

end;

function TDMFileInfoGroup.PrepareTestQuery: string;
begin
  Result := inherited PrepareTestQuery;
  Result := StringReplace(Result, ':DOC_TYPE_NAME', DocTypeName, [rfReplaceAll]);
  Result := StringReplace(Result, ':MATERIAL_TYPES_ID', DocumentTypes.IDList(','), [rfReplaceAll]);
end;

{ TCoreDescriptionFileInfoGroup }

procedure TCoreDescriptionFileInfoGroup.InitializeInfoGroup;
begin
  DefaultExt := '.doc';

  inherited;
  Name := 'Описание керна';
  Tag := 'Описание керна';
  Place := 'Документы и материалы';

  DocTypeName := 'Описание керна';
  DocumentTypes.Add(TMainFacade.GetInstance.DocumentTypes.ItemsByID[19], False, False);
  DocumentTypes.Add(TMainFacade.GetInstance.DocumentTypes.ItemsByID[39], False, False);
  DocumentTypes.Add(TMainFacade.GetInstance.DocumentTypes.ItemsByID[57], False, False);
  DocumentTypes.Add(TMainFacade.GetInstance.DocumentTypes.ItemsByID[58], False, False);
end;

{ TInclinometrFileInfoGroup }

procedure TInclinometrFileInfoGroup.InitializeInfoGroup;
begin
  inherited;
  Name := 'Данные инклинометрии';
  Tag := 'Данные инклинометрии';
  Place := 'Документы и материалы';
  DefaultExt := '.jpg';

  TestQuery := 'select m.vch_location, rf_trim(rf_strreplace(' + 'mt.vch_material_type_name||' + '''' + ' ' + '''' + '||w.vch_well_num||' + '''' + ' - ' + '''' + '||a.vch_area_name,' + '''' + '(-ое)' + '''' + ',' + '''' + '''' + '))||' + '''' + DefaultExt + '''' + ',' +
               'm.vch_location ' +
               'from tbl_material m, tbl_material_binding mb, tbl_well w, tbl_area_dict a, tbl_material_type mt ' +
               'where m.material_type_id in (:MATERIAL_TYPES_ID) and m.material_id = mb.material_id and mb.object_bind_type_id = 1 ' +
               'and w.area_id = a.area_id and mb.object_bind_id = w.well_uin ' +
               'and m.Material_type_id = mt.Material_Type_Id ' +
               'and mb.object_bind_id = %s';

  DocTypeName := 'Данные инклинометрии';
  DocumentTypes.Add(TMainFacade.GetInstance.DocumentTypes.ItemsByID[60], False, False);
  DocumentTypes.Add(TMainFacade.GetInstance.DocumentTypes.ItemsByID[61], False, False);
  DocumentTypes.Add(TMainFacade.GetInstance.DocumentTypes.ItemsByID[62], False, False);
end;

{ TGranulometryReportInfoGroup }

procedure TGranulometryReportInfoGroup.InitializeInfoGroup;
begin
  inherited;
  TestQuery := 'select * from tbl_dnr_research d, tbl_rock_sample rs, tbl_slotting s where d.rock_sample_uin = rs.rock_sample_uin and s.slotting_uin = rs.slotting_uin and d.research_id >= 300 and d.research_id < 400 and s.Well_UIN = %s';
  Name := 'Гранулометрический состав пород';
  Tag := 'Петрофизика';
  Place := 'РБЦГИ';
  ReportClass := TGranulometryReport;
end;

{ TCentrifugingReportInfoGroup }

procedure TCentrifugingReportInfoGroup.InitializeInfoGroup;
begin
  inherited;
  TestQuery := 'select * from tbl_dnr_research d, tbl_rock_sample rs, tbl_slotting s where d.rock_sample_uin = rs.rock_sample_uin and s.slotting_uin = rs.slotting_uin and d.research_id >= 200 and d.research_id < 300 and s.Well_UIN = %s';
  Name := 'Центрифугирование';
  Tag := 'Петрофизика';
  Place := 'РБЦГИ';
  ReportClass := TCentrifugingReport;
end;

{ TDMPetrofisicsFileInfoGroup }

function TDMPetrofisicsFileInfoGroup.GetUserFolderName: string;
begin
  Result := Tag;
end;

procedure TDMPetrofisicsFileInfoGroup.InitializeInfoGroup;
begin
  inherited;
  Name := 'Петрофизические исследования прошлых лет';
  Tag := 'Петрофизика';
  Place := 'Документы и материалы';
  DefaultExt := '.xls';

  TestQuery := 'select m.vch_location, rf_trim(rf_strreplace(' + 'mt.vch_material_type_name||' + '''' + ' ' + '''' + '||w.vch_well_num||' + '''' + ' - ' + '''' + '||a.vch_area_name,' + '''' + '(-ое)' + '''' + ',' + '''' + '''' + '))||' + '''' + DefaultExt + '''' + ',' +
               'm.vch_location ' +
               'from tbl_material m, tbl_material_binding mb, tbl_well w, tbl_area_dict a, tbl_material_type mt ' +
               'where m.material_type_id in (:MATERIAL_TYPES_ID) and m.material_id = mb.material_id and mb.object_bind_type_id = 1 ' +
               'and w.area_id = a.area_id and mb.object_bind_id = w.well_uin ' +
               'and m.Material_type_id = mt.Material_Type_Id ' +
               'and mb.object_bind_id = %s';

  DocTypeName := 'Петрофизические исследования прошлых лет';
  DocumentTypes.Add(TMainFacade.GetInstance.DocumentTypes.ItemsByID[32], False, False);
  DocumentTypes.Add(TMainFacade.GetInstance.DocumentTypes.ItemsByID[63], False, False);
  DocumentTypes.Add(TMainFacade.GetInstance.DocumentTypes.ItemsByID[64], False, False);
  DocumentTypes.Add(TMainFacade.GetInstance.DocumentTypes.ItemsByID[65], False, False);  
end;

{ TStLasFileInfoGroup }

procedure TStLasFileInfoGroup.InitializeInfoGroup;
begin
  inherited;
  TestQuery := 'select distinct lf.vch_filename, lf.vch_old_filename from tbl_las_file lf, tbl_las_curve lc, tbl_curve_dict cc where cc.curve_id = lc.curve_id and lf.las_file_uin = lc.las_file_uin and cc.curve_category_id in (5,9,10,17,18,19) and lf.well_uin = %s';

  Name := 'Стандартный каротаж';
  CropCurves := True;
  Encoding := encAnsi;

  CurvesToLeave.Add('DEPT');
  CurvesToLeave.Add('DEPTH');
  CurvesToLeave.Add('1ПР');
  CurvesToLeave.Add('2ПР');
  CurvesToLeave.Add('A04M01N');
  CurvesToLeave.Add('A05M8N');
  CurvesToLeave.Add('A1M01N');
  CurvesToLeave.Add('A1M05N');
  CurvesToLeave.Add('A2M05N');
  CurvesToLeave.Add('A4M05N');
  CurvesToLeave.Add('A8M01N');
  CurvesToLeave.Add('A8M10N');
  CurvesToLeave.Add('A8M1N');
  CurvesToLeave.Add('BS');
  CurvesToLeave.Add('CAL');
  CurvesToLeave.Add('CAL1');
  CurvesToLeave.Add('CAL2');
  CurvesToLeave.Add('CALI');
  CurvesToLeave.Add('DS');
  CurvesToLeave.Add('DS1');
  CurvesToLeave.Add('DS2');
  CurvesToLeave.Add('DS_m');
  CurvesToLeave.Add('DSn');
  CurvesToLeave.Add('Dn');
  CurvesToLeave.Add('Dn_m');
  CurvesToLeave.Add('EL07');
  CurvesToLeave.Add('EN20');
  CurvesToLeave.Add('GZ');
  CurvesToLeave.Add('GZ1');
  CurvesToLeave.Add('GZ2');
  CurvesToLeave.Add('GZ3');
  CurvesToLeave.Add('GZ4');
  CurvesToLeave.Add('GZ5');
  CurvesToLeave.Add('GZ6');
  CurvesToLeave.Add('GZK');
  CurvesToLeave.Add('KC4');
  CurvesToLeave.Add('LES1');
  CurvesToLeave.Add('N05M2A');
  CurvesToLeave.Add('N11.0M0.5A');
  CurvesToLeave.Add('N11.0М0,5А');
  CurvesToLeave.Add('N11M05A');
  CurvesToLeave.Add('N6M05A');
  CurvesToLeave.Add('PR1');
  CurvesToLeave.Add('PR2');
  CurvesToLeave.Add('PS');
  CurvesToLeave.Add('PZ');
  CurvesToLeave.Add('PZ1');
  CurvesToLeave.Add('PZ3');
  CurvesToLeave.Add('PZ5');
  CurvesToLeave.Add('PZ6');
  CurvesToLeave.Add('R1скв');
  CurvesToLeave.Add('R2скв');
  CurvesToLeave.Add('R3скв');
  CurvesToLeave.Add('R4скв');
  CurvesToLeave.Add('Rскв1');
  CurvesToLeave.Add('Rскв2');
  CurvesToLeave.Add('Rскв3');
  CurvesToLeave.Add('Rскв4');
  CurvesToLeave.Add('SP');
  CurvesToLeave.Add('SPисх');
  CurvesToLeave.Add('pz');
  CurvesToLeave.Add('ГЗ');
  CurvesToLeave.Add('ДС');
  CurvesToLeave.Add('ДС  св1');
  CurvesToLeave.Add('ДС  св2');
  CurvesToLeave.Add('ДС  св3');
  CurvesToLeave.Add('ДС1');
  CurvesToLeave.Add('ДС2');
  CurvesToLeave.Add('ДС3');
  CurvesToLeave.Add('ДС_1');
  CurvesToLeave.Add('ДС_2');
  CurvesToLeave.Add('ДСН');
  CurvesToLeave.Add('ДСн');
  CurvesToLeave.Add('ДСн  св1');
  CurvesToLeave.Add('ДСн св2');
  CurvesToLeave.Add('ДСн1');
  CurvesToLeave.Add('ДСн2');
  CurvesToLeave.Add('ДСном');
  CurvesToLeave.Add('Дс1');
  CurvesToLeave.Add('Дс2');
  CurvesToLeave.Add('КАВ');
  CurvesToLeave.Add('КВ');
  CurvesToLeave.Add('КВ1');
  CurvesToLeave.Add('КВ2');
  CurvesToLeave.Add('КВ3');
  CurvesToLeave.Add('КС1');
  CurvesToLeave.Add('КС2');
  CurvesToLeave.Add('КС2Вр1');
  CurvesToLeave.Add('КС2Вр2');
  CurvesToLeave.Add('КС2Вр3');
  CurvesToLeave.Add('КС3');
  CurvesToLeave.Add('КС3Вр1');
  CurvesToLeave.Add('КС3Вр2');
  CurvesToLeave.Add('КС3Вр3');
  CurvesToLeave.Add('КС3Вр4');
  CurvesToLeave.Add('КС4');
  CurvesToLeave.Add('КС4_1');
  CurvesToLeave.Add('КС5');
  CurvesToLeave.Add('КС5   св1');
  CurvesToLeave.Add('КС5  св2');
  CurvesToLeave.Add('КС5  св3');
  CurvesToLeave.Add('КС6');
  CurvesToLeave.Add('КС7');
  CurvesToLeave.Add('КС8');
  CurvesToLeave.Add('КС8к');
  CurvesToLeave.Add('КС?');
  CurvesToLeave.Add('ПЗ');
  CurvesToLeave.Add('ПЗ св1');
  CurvesToLeave.Add('ПЗ св2');
  CurvesToLeave.Add('ПЗ св3');
  CurvesToLeave.Add('ПЗ1');
  CurvesToLeave.Add('ПЗ2');
  CurvesToLeave.Add('ПР1');
  CurvesToLeave.Add('ПР2');
  CurvesToLeave.Add('ПС');
  CurvesToLeave.Add('ПС св1');
  CurvesToLeave.Add('ПС св2');
  CurvesToLeave.Add('ПС св3');
  CurvesToLeave.Add('ПС1');
  CurvesToLeave.Add('ПСсп');

  Replacements := TLasReplacements.Create;

  ////2-------- это для такого случая:   WeLL.     WELL:5----------------//
  {
  Replacements.AddReplacement('~Well', 'WELL', '   WELL:2', '2_Saluk: ');
  Replacements.AddReplacement('~Well', 'FLD', 'FIELD:Салюкинская (-ое)', '     :                 ');
  }


  Replacements.AddReplacement('~Well', 'WELL', '        91', '91_Yareyag');
  Replacements.AddReplacement('~Well', 'FLD', 'Ярейягинская', '            ');


  Replacements.AddReplacement('~Curve','А','А','A');
  Replacements.AddReplacement('~Curve','Б','Б','B');
  Replacements.AddReplacement('~Curve','В','В','V');
  Replacements.AddReplacement('~Curve','Г','Г','G');
  Replacements.AddReplacement('~Curve','Д','Д','D');
  Replacements.AddReplacement('~Curve','Е','Е','E');
  Replacements.AddReplacement('~Curve','Ж','Ж','J');
  Replacements.AddReplacement('~Curve','З','З','Z');
  Replacements.AddReplacement('~Curve','И','И','I');
  Replacements.AddReplacement('~Curve','К','К','K');
  Replacements.AddReplacement('~Curve','Л','Л','L');
  Replacements.AddReplacement('~Curve','М','М','M');
  Replacements.AddReplacement('~Curve','Н','Н','N');
  Replacements.AddReplacement('~Curve','О','О','O');
  Replacements.AddReplacement('~Curve','П','П','P');
  Replacements.AddReplacement('~Curve','Р','Р','R');
  Replacements.AddReplacement('~Curve','С','С','S');
  Replacements.AddReplacement('~Curve','Т','Т','T');
  Replacements.AddReplacement('~Curve','У','У','U');
  Replacements.AddReplacement('~Curve','Ф','Ф','F');
  Replacements.AddReplacement('~Curve','Х','Х','H');
  Replacements.AddReplacement('~Curve','Ц','Ц','C');
  Replacements.AddReplacement('~Curve','Ч','Ч','Ch');
  Replacements.AddReplacement('~Curve','Ш','Ш','Sh');
  Replacements.AddReplacement('~Curve','Щ','Щ','Sch');
  Replacements.AddReplacement('~Curve','Э','Э','A');
  Replacements.AddReplacement('~Curve','Ю','Ю','U');
  Replacements.AddReplacement('~Curve','Я','Я','Ya');
end;

{ TAKLasFileInfoGroup }

procedure TAKLasFileInfoGroup.InitializeInfoGroup;
begin
  inherited;
  TestQuery := 'select distinct lf.vch_filename, lf.vch_old_filename from tbl_las_file lf, tbl_las_curve lc, tbl_curve_dict cc where cc.curve_id = lc.curve_id and lf.las_file_uin = lc.las_file_uin and cc.curve_category_id in (2) and lf.well_uin = %s';

  Name := 'Акустический каротаж';
  CropCurves := True;

  CurvesToLeave.Add('DEPT');
  CurvesToLeave.Add('DEPTH');

  CurvesToLeave.Add('АКДТ');
  CurvesToLeave.Add('АКТ1');
  CurvesToLeave.Add('АКТ2');
  CurvesToLeave.Add('АЛФ');
  CurvesToLeave.Add('А1');
  CurvesToLeave.Add('А2');
  CurvesToLeave.Add('АКДТ');
  CurvesToLeave.Add('АКДТ');
  CurvesToLeave.Add('АКТ1');
  CurvesToLeave.Add('АКT2');
  CurvesToLeave.Add('A2');
  CurvesToLeave.Add('A1');
  CurvesToLeave.Add('A1Lн');
  CurvesToLeave.Add('A2Lн');
  CurvesToLeave.Add('АЛФLн');
  CurvesToLeave.Add('Т1Lн');
  CurvesToLeave.Add('Т2Lн');
  CurvesToLeave.Add('ДТLн');
  CurvesToLeave.Add('A1s');
  CurvesToLeave.Add('A1s');
  CurvesToLeave.Add('A2s');
  CurvesToLeave.Add('АЛФsн');
  CurvesToLeave.Add('A1sн');
  CurvesToLeave.Add('A2sн');
  CurvesToLeave.Add('ДТsн');
  CurvesToLeave.Add('Т1sн');
  CurvesToLeave.Add('Т2sн');
  CurvesToLeave.Add('A1pв');
  CurvesToLeave.Add('A2pв');
  CurvesToLeave.Add('АЛФрв');
  CurvesToLeave.Add('ДТрв');
  CurvesToLeave.Add('Т1рв');
  CurvesToLeave.Add('Т2рв');
  CurvesToLeave.Add('Ddol');
  CurvesToLeave.Add('DT');
  CurvesToLeave.Add('АКДТ');
  CurvesToLeave.Add('ДТ');
  CurvesToLeave.Add('Т1рв');
  CurvesToLeave.Add('BAT1');
  CurvesToLeave.Add('BAT2');
  CurvesToLeave.Add('DTCO');
  CurvesToLeave.Add('АКДТ');
  CurvesToLeave.Add('DTL');
  CurvesToLeave.Add('DTLM');
  CurvesToLeave.Add('DTP');
  CurvesToLeave.Add('DTS');
  CurvesToLeave.Add('АЛФ2');
  CurvesToLeave.Add('АЛФ1');
  CurvesToLeave.Add('АКT1');
  CurvesToLeave.Add('DTP1');
  CurvesToLeave.Add('T1');
  CurvesToLeave.Add('T2');
  CurvesToLeave.Add('АК');
  CurvesToLeave.Add('АКДТ');
  CurvesToLeave.Add('AZT');
  CurvesToLeave.Add('DТ');
  CurvesToLeave.Add('АК');
  CurvesToLeave.Add('DT');
  CurvesToLeave.Add('ALFA');

  Replacements := TLasReplacements.Create;
end;

{ TLasReplacements }

constructor TLasReplacements.Create;
begin
  inherited;
  AddReplacement('~Curve','','KC4','GZ4');
  AddReplacement('~Curve','','NGK','NGR');
  AddReplacement('~Curve','','НГК','NGR');
  AddReplacement('~Curve','','PS','SP');
  AddReplacement('~Curve','','ГГКП','GGRp');
  AddReplacement('~Curve','','ГГКп','GGRp');
  AddReplacement('~Curve','','ГКи','GRi');
  AddReplacement('~Curve','','ГК','GR');
  AddReplacement('~Curve','','ДСн1','Dn  ');
  AddReplacement('~Curve','','ДСн2','Dn  ');
  AddReplacement('~Curve','','ДСн','Dn ');
  AddReplacement('~Curve','','ДС','DS');
  AddReplacement('~Curve','','КС4','GZ4');
  AddReplacement('~Curve','','ННКТ','NNKT');
  AddReplacement('~Curve','','ННТБ','NNTb');
  AddReplacement('~Curve','','ННТМ','NNTm');
  AddReplacement('~Curve','','ПЗ','PZ');
  AddReplacement('~Curve','','ПС','SP');

  AddReplacement('~Curve','','г/см3','g/cm3');
  AddReplacement('~Curve','','мкр/час','ur/h   ');
  AddReplacement('~Curve','','имп/мин','imp/min');
  AddReplacement('~Curve','','мм','mm');
  AddReplacement('~Curve','','Омм','Omm');
  AddReplacement('~Curve','','у.е.','u.e.');
  AddReplacement('~Curve','','ус.е','u.e. ');
  AddReplacement('~Curve','','Омм','Omm');
  AddReplacement('~Curve','','мВ','mv');
end;

{ TAllLasFileCopy }

procedure TAllLasFileCopyAnsi.InitializeInfoGroup;
begin
  inherited;
  CropCurves := false;
  MakeReplacements := false;
  CropBlocks := false;
  Encoding := encAnsi;

  TestQuery := 'select distinct lf.vch_filename, lf.vch_old_filename from tbl_las_file lf, tbl_las_curve lc where lf.las_file_uin = lc.las_file_uin and lf.well_uin = %s';

  Name := 'LAS(ANSI)';
end;

{ TAllLasFileCopyAscii }

procedure TAllLasFileCopyAscii.InitializeInfoGroup;
begin
  inherited;
  CropCurves := false;
  MakeReplacements := false;
  CropBlocks := false;
  Encoding := encAscii;

  TestQuery := 'select distinct lf.vch_filename, lf.vch_old_filename from tbl_las_file lf, tbl_las_curve lc where lf.las_file_uin = lc.las_file_uin and lf.well_uin = %s';

  Name := 'LAS(ASCII)';
end;

{ TStandardSubdivisionReport }

procedure TStandardSubdivisionReportInfoGroup.InitializeInfoGroup;
begin
  inherited;
  Name := 'Стратиграфические разбивки';
  Tag := 'Стратиграфия';
  Place := 'РБЦГИ';
  TestQuery := 'select * from tbl_subdivision_component sc, tbl_Subdivision s where s.subdivision_id = sc.subdivision_id and  s.well_uin in (%s)';
  IsSingle := True;
  ReportClass := TStandardSubdivisionReport;
end;

{ TSchlifDescriptionFileInfoGroup }

procedure TSchlifDescriptionFileInfoGroup.InitializeInfoGroup;
begin
  DefaultExt := '.doc';

  inherited;
  Name := 'Описание шлифов';
  Tag := 'Описание шлифов';
  Place := 'Документы и материалы';

  DocTypeName := 'Описание шлифов';
  DocumentTypes.Add(TMainFacade.GetInstance.DocumentTypes.ItemsByID[38], False, False);
  DocumentTypes.Add(TMainFacade.GetInstance.DocumentTypes.ItemsByID[20], False, False);
  DocumentTypes.Add(TMainFacade.GetInstance.DocumentTypes.ItemsByID[48], False, False);
  DocumentTypes.Add(TMainFacade.GetInstance.DocumentTypes.ItemsByID[51], False, False);
end;

{ TSchlamDescriptionFileInfoGroup }

procedure TSchlamDescriptionFileInfoGroup.InitializeInfoGroup;
begin
  inherited;
  DefaultExt := '.doc';

  inherited;
  Name := 'Описание шлама';
  Tag := 'Описание шлама';
  Place := 'Описание шлама';

  DocTypeName := 'Описание керна';
  DocumentTypes.Add(TMainFacade.GetInstance.DocumentTypes.ItemsByID[34], False, False);
end;

end.
